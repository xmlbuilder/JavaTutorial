# ReentrantLock ëŒ€ê¸° ì¤‘ë‹¨
ì•„ë˜ëŠ” ReentrantLockì˜ ëŒ€ê¸° ì¤‘ë‹¨ ê¸°ëŠ¥ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë‹¨ê³„ë³„ë¡œ ì²´ê³„ì ìœ¼ë¡œ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.  
ì˜ˆì œ íë¦„ê³¼ ìŠ¤ë ˆë“œ ìƒíƒœ ë³€í™”ê¹Œì§€ í•¨ê»˜ ì„¤ëª….

## ì†ŒìŠ¤ ì½”ë“œ
```java
public class BankAccountV5 implements BankAccount {
`    private int balance;
    private final Lock lock = new ReentrantLock();

    public BankAccountV5(int initialBalance) {
        this.balance = initialBalance;
    }

    @Override
    public boolean withdraw(int amount) {
        log("ê±°ë˜ ì‹œì‘: " + getClass().getSimpleName());
        
        if (!lock.tryLock()) {
            log("[ì§„ì… ì‹¤íŒ¨] ì´ë¯¸ ì²˜ë¦¬ì¤‘ì¸ ì‘ì—…ì´ ìˆìŠµë‹ˆë‹¤.");
            return false;
        }
        try {
            log("[ê²€ì¦ ì‹œì‘] ì¶œê¸ˆì•¡: " + amount + ", ì”ì•¡: " + balance);

            if (balance < amount) {
                log("[ê²€ì¦ ì‹¤íŒ¨] ì¶œê¸ˆì•¡: " + amount + ", ì”ì•¡: " + balance);
                return false;
            }

            sleep(1000);

            balance = balance - amount;
            log("[ì¶œê¸ˆ ì™„ë£Œ] ì¶œê¸ˆì•¡: " + amount + ", ë³€ê²½ ì”ì•¡: " + balance);
        } finally {
            lock.unlock(); // ReentrantLock ì´ìš©í•˜ì—¬ lock í•´ì œ
        }
        log("ê±°ë˜ ì¢…ë£Œ");
        return true;
    }

    @Override
    public int getBalance() {
        lock.lock(); // ReentrantLock ì´ìš©í•˜ì—¬ lock ê±¸ê¸°
        try {
            return balance;
        } finally {
            lock.unlock(); // ReentrantLock ì´ìš©í•˜ì—¬ lock í•´ì œ
        }
    }
}
```

## ğŸ” ReentrantLock â€“ ëŒ€ê¸° ì¤‘ë‹¨ ê¸°ëŠ¥ ë‹¨ê³„ë³„ ì •ë¦¬
### 1ï¸âƒ£ ë°°ê²½: ì™œ ëŒ€ê¸° ì¤‘ë‹¨ì´ í•„ìš”í•œê°€?
- `synchronized` ëŠ” ë½ì„ ì–»ì„ ë•Œê¹Œì§€ ë¬´í•œ ëŒ€ê¸°í•˜ë©°, ì¸í„°ëŸ½íŠ¸ ë¶ˆê°€
- `ReentrantLock` ì€ ë” ìœ ì—°í•˜ê²Œ:
    - ì¦‰ì‹œ í¬ê¸° (tryLock())
    - ì‹œê°„ ì œí•œ ëŒ€ê¸° (tryLock(time))

### 2ï¸âƒ£ ì¦‰ì‹œ í¬ê¸°: tryLock()
- âœ… íŠ¹ì§•
    - ë½ì„ ì¦‰ì‹œ ì‹œë„í•˜ê³ , ì‹¤íŒ¨í•˜ë©´ false ë°˜í™˜
    - ëŒ€ê¸°í•˜ì§€ ì•ŠìŒ, ìŠ¤ë ˆë“œ ìƒíƒœëŠ” RUNNABLE ìœ ì§€
#### ğŸ’¡ ì˜ˆì‹œ íë¦„
```java
if (!lock.tryLock()) {
    log("[ì§„ì… ì‹¤íŒ¨] ì´ë¯¸ ì²˜ë¦¬ì¤‘ì¸ ì‘ì—…ì´ ìˆìŠµë‹ˆë‹¤.");
    return false;
}
```

### ğŸ§µ ì‹¤í–‰ íë¦„

| ìŠ¤ë ˆë“œ | ë™ì‘ ì„¤ëª…                                      |
|--------|------------------------------------------------|
| t1     | ë½ íšë“ í›„ ì„ê³„ ì˜ì—­ ì‹¤í–‰                       |
| t2     | `tryLock()` ì‹¤íŒ¨ â†’ ì¦‰ì‹œ í¬ê¸° (`false` ë°˜í™˜)     |
| t2     | ë©”ì„œë“œ ì¢…ë£Œ â†’ `TERMINATED` ìƒíƒœ ì§„ì…            |
| t1     | ì„ê³„ ì˜ì—­ ì¢…ë£Œ í›„ `unlock()` í˜¸ì¶œ               |


### 3ï¸âƒ£ ì‹œê°„ ì œí•œ ëŒ€ê¸°: tryLock(time, unit)
- âœ… íŠ¹ì§•
    - ì§€ì •ëœ ì‹œê°„ ë™ì•ˆ ë½ì„ ì‹œë„
    - ì‹œê°„ ë‚´ ì‹¤íŒ¨ ì‹œ false ë°˜í™˜
    - ëŒ€ê¸° ì¤‘ ì¸í„°ëŸ½íŠ¸ ê°€ëŠ¥
    - ìŠ¤ë ˆë“œ ìƒíƒœ: TIMED_WAITING â†’ RUNNABLE

#### ğŸ’¡ ì˜ˆì‹œ íë¦„
```java
if (!lock.tryLock(500, TimeUnit.MILLISECONDS)) {
    log("[ì§„ì… ì‹¤íŒ¨] ì´ë¯¸ ì²˜ë¦¬ì¤‘ì¸ ì‘ì—…ì´ ìˆìŠµë‹ˆë‹¤.");
    return false;
}
```

#### ğŸ§µ ì‹¤í–‰ íë¦„

| ìŠ¤ë ˆë“œ | ë™ì‘ ì„¤ëª…                                      |
|--------|------------------------------------------------|
| t1     | ë½ íšë“ í›„ ì„ê³„ ì˜ì—­ ì‹¤í–‰                       |
| t2     | `tryLock(time)` í˜¸ì¶œ â†’ `TIMED_WAITING` ìƒíƒœ ì§„ì… |
| t2     | ì‹œê°„ ì´ˆê³¼ â†’ ë½ íšë“ ì‹¤íŒ¨ â†’ `false` ë°˜í™˜          |
| t1     | ì„ê³„ ì˜ì—­ ì¢…ë£Œ í›„ `unlock()` í˜¸ì¶œ               |

### 4ï¸âƒ£ ë‚´ë¶€ ë™ì‘ ìš”ì•½

| ë™ì‘ ë˜ëŠ” ë©”ì„œë“œ             | ì„¤ëª… ë˜ëŠ” ê²°ê³¼                                |
|------------------------------|-----------------------------------------------|
| `tryLock()`                    | ë½ íšë“ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ false ë°˜í™˜                |
| `tryLock(time, unit)`          | ë‚´ë¶€ì ìœ¼ë¡œ `LockSupport.parkNanos()` í˜¸ì¶œ      |
| ìƒíƒœ ì „ì´                    | `TIMED_WAITING` â†’ ì‹œê°„ ì´ˆê³¼ í›„ `RUNNABLE` ë³µê·€ |
| ì˜ˆì™¸ ì•ˆì „ì„±                  | `finally` ë¸”ë¡ì—ì„œ `unlock()` ë°˜ë“œì‹œ í˜¸ì¶œ      |

### 5ï¸âƒ£ ì •ë¦¬: ReentrantLockì˜ ìœ ì—°í•œ ì œì–´

| í•­ëª©                     | ì„¤ëª… ë˜ëŠ” ê´€ë ¨ ê¸°ëŠ¥                                      |
|--------------------------|----------------------------------------------------------|
| ëŒ€ê¸° ì¤‘ë‹¨                | `tryLock()`, `tryLock(time)`ìœ¼ë¡œ ë¬´í•œ ëŒ€ê¸° ë°©ì§€ ê°€ëŠ¥       |
| ì‹œê°„ ì œí•œ ëŒ€ê¸°           | `tryLock(time)` ì‚¬ìš© ì‹œ ì§€ì • ì‹œê°„ë§Œí¼ ëŒ€ê¸° í›„ í¬ê¸° ê°€ëŠ¥     |
| ìƒíƒœ ì „ì´                | `RUNNABLE` â†” `TIMED_WAITING` â†” `TERMINATED` ëª…í™•íˆ ê´€ë¦¬    |
| ì˜ˆì™¸ ì•ˆì „ì„±              | `finally` ë¸”ë¡ì—ì„œ `unlock()` í˜¸ì¶œë¡œ ë½ ë°˜ë‚© ë³´ì¥          |
| ê³µì •ì„± ì„¤ì •              | `new ReentrantLock(true)`ë¡œ ëŒ€ê¸° ìˆœì„œëŒ€ë¡œ ë½ íšë“ ê°€ëŠ¥      |


## ğŸ§  ì¶”ê°€ íŒ
- tryLock()ì€ ë‚®ì€ ì§€ì—°ê³¼ ë¹ ë¥¸ ì‘ë‹µì´ í•„ìš”í•œ ì‹œìŠ¤í…œì— ì í•©
- tryLock(time)ì€ ì œí•œëœ ì‹œê°„ ë™ì•ˆë§Œ ìì› ì ‘ê·¼ì„ ì‹œë„í•  ë•Œ ìœ ìš©
- ReentrantLockì€ synchronizedë³´ë‹¤ ë” ì„¸ë°€í•œ ë™ì‹œì„± ì œì–´ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•¨

---

